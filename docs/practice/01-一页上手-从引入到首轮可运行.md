# 一页上手：从引入到首轮可运行

这篇只做一件事：  
让你在最短路径里跑通 SBK 第一轮闭环。

---

## 1. 前置条件（手动）

在仓库根目录执行：

```powershell
node -v
git --version
openspec --version
powershell -ExecutionPolicy Bypass -File ./scripts/sbk.ps1
```

你至少要看到：

- Node 可用（项目要求 `>=20.19.0`）。
- `openspec` 可用。
- `sbk` 命令帮助成功输出。

---

## 2. 初始化与健康检查（手动）

```powershell
npm install
npm run workflow:doctor
npm run verify:fast
```

成功判定：

- `workflow:doctor` 通过。
- `verify:fast` 通过。
- `.metrics/verify-runs.jsonl` 出现新的记录。

失败恢复：

- 先运行：

```powershell
npm run verify:loop -- -Profile fast -MaxAttempts 2
```

- 再查看：
  - `.metrics/workflow-doctor.md`
  - `.metrics/workflow-policy-gate.md`
  - `.metrics/workflow-docs-sync-gate.md`

---

## 3. 首轮闭环推荐命令（手动）

### 方案 A：新项目 / 空仓（greenfield）

```powershell
sbk flow run --scenario greenfield --decision-mode auto --project-type backend --adapter node-ts --channel stable --with-install --preset minimal --target-repo-root .
```

### 方案 B：已有项目（brownfield）

```powershell
sbk flow run --scenario brownfield --decision-mode auto --channel stable --target-repo-root .
```

> 如果 `sbk` 别名不可用，使用：  
> `powershell -ExecutionPolicy Bypass -File ./scripts/sbk.ps1 flow run ...`

成功判定：

- `.metrics/flow-run-report.json` 的 `status` 为 `passed`。
- 你能看到 intake、adapter doctor、verify fast 阶段已执行并通过。

---

## 4. 第一轮后立刻做的两件事（手动）

```powershell
sbk capabilities
npm run metrics:collect
```

看什么：

- `sbk capabilities`：确认当前平台能力边界（Codex/Claude 等）。
- `.metrics/workflow-metrics-latest.json`：确认指标快照已生成。

---

## 5. Codex 提示词模板（可直接复制）

### 模板 1：一键首轮闭环（推荐）

```text
请你先读取 scripts/sbk.ps1、sbk.config.json、workflow-policy.json，确认当前默认 adapter/profile/channel。
然后自动执行首轮闭环：
1) npm install
2) npm run workflow:doctor
3) sbk flow run --scenario auto --decision-mode auto --channel stable --target-repo-root .
4) npm run verify:fast
5) npm run metrics:collect

要求：
- 每一步失败就先最小修复再继续；
- 最后给我一份结果摘要：通过/失败、生成了哪些 .metrics 文件、下一步建议。
```

### 模板 2：失败后自动恢复

```text
当前首轮闭环失败。请你：
1) 运行 npm run verify:loop -- -Profile fast -MaxAttempts 2
2) 汇总 .metrics 下以下报告的关键失败项：
   - workflow-policy-gate.md
   - workflow-docs-sync-gate.md
   - workflow-doctor.md
3) 给出按优先级排序的修复清单并自动执行前两项修复
4) 复跑 npm run verify:fast 并告诉我是否恢复
```

---

## 6. 什么时候不用这一页流程

- 你已经明确要做多仓协同治理：直接去 `04-能力手册-命令分层与组合策略.md` 里的 `fleet` 章节。
- 你要做 OpenSpec 规格迁移：直接去 `04` 的 `migrate-specs` 章节。
- 你只关心平台差异/Beta：直接看 `08-附录-平台差异与Beta能力.md`。
