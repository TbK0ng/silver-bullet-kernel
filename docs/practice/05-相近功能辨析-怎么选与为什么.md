# 相近功能辨析：怎么选与为什么

这篇专门解决一个问题：  
“这些命令看起来都能做同一件事，我该用哪个？”

---

## 1. `install` vs `upgrade`

### 用法

```powershell
sbk install --target-repo-root <repo> --preset minimal --channel stable
sbk upgrade --target-repo-root <repo> --preset minimal --channel stable
```

### 怎么选

- 第一次接入：用 `install`
- 已接入后更新内核：用 `upgrade`

### 优劣

- `install` 优点：默认不覆盖，更安全。缺点：旧文件可能保留旧逻辑。
- `upgrade` 优点：覆盖更新快。缺点：风险更高，需先确认差异。
- 二者共同边界：负责分发/升级 SBK 内核，不负责生成 `PROJECT.md` 等项目规划文件。

### 何时不用

- 只想生成项目规划文件：不用二者，用 `greenfield`。

---

## 2. `greenfield` vs `blueprint apply` vs `flow run`

### 核心差异

- `greenfield`：生成项目级规划与最小语言脚手架。
- `blueprint apply`：注入可上线基线模板（CI、安全、架构、runbook）。
- `flow run`：把多步骤串起来自动执行并产出执行报告。

### 推荐顺序

1. 新项目：`greenfield`
2. 需要治理基线：`blueprint apply`
3. 需要稳定流程执行：`flow run`

### 何时直接用 `flow run`

- 你已经熟悉参数，且希望一次跑完主要流程。

### 何时不要直接用 `flow run`

- 你在排查某个具体失败点，需要分步定位（先手动拆开执行）。

---

## 3. `flow run --decision-mode auto` vs `ask`

### 怎么选

- 默认：`auto`
- 你要人工确认每个关键决策：`ask`

### 优劣

- `auto` 优点：快、标准化。缺点：新手可能不知道系统如何决策。
- `ask` 优点：可控。缺点：慢，且容易在团队中产生不一致操作。

---

## 4. `intake verify` 的 `strict` / `balanced` / `lite`

### 怎么选

- 生产默认：`strict`
- 历史包袱很重，先恢复节奏：`balanced`
- 早期探索或临时救火：`lite`

### 优劣

- `strict`：治理强、风险低，但初期通过难。
- `balanced`：通过率与治理折中。
- `lite`：推进快，但流程约束明显弱化。

### 使用建议

- 允许“先 balanced，再回 strict”，但要有回升计划。

---

## 5. `verify:fast` vs `verify` vs `verify:ci` vs `verify:loop`

### 角色定位

- `verify:fast`：开发中高频使用。
- `verify`：提交前完整本地验证。
- `verify:ci`：合并前模拟 CI 级别流程。
- `verify:loop`：失败后自动重试 + 诊断。

### 推荐节奏

1. 编码中：`verify:fast`
2. 提交前：`verify`
3. 合并前：`verify:ci`
4. 连续失败：`verify:loop`

---

## 6. `doctor` vs `policy` vs `docs-sync` vs `skill-parity` vs `workflow:gate`

### 核心区别

- `doctor`：总览健康检查（偏体检入口）。
- `policy`：流程政策是否合规（分支、worktree、OpenSpec、证据等）。
- `docs-sync`：运行时改动是否同步更新必需文档。
- `skill-parity`：多平台技能/命令是否一致。
- `workflow:gate`（indicator gate）：指标阈值是否超线（失败率、返工、漂移等）。

### 记忆法

- “有没有病”看 `doctor`
- “合不合规”看 `policy`
- “文档跟没跟上”看 `docs-sync`
- “分发是否对齐”看 `skill-parity`
- “过程数据健康吗”看 `workflow:gate`

---

## 7. `adapter doctor` vs `doctor`

### 区别

- `adapter doctor`：只看适配器契约与能力完整性。
- `doctor`：看整个工作流系统健康。

### 选择

- 语言生态/命令矩阵异常：先 `adapter doctor`
- 不确定哪里出问题：先 `doctor`

---

## 8. `semantic rename` vs `reference-map` vs `safe-delete-candidates`

### 区别

- `reference-map`：先看引用关系。
- `safe-delete-candidates`：先看哪些符号“可能可删”。
- `rename`：真正执行重命名。

### 推荐顺序

1. `reference-map`
2. `safe-delete-candidates`
3. `rename --dry-run`
4. `rename`（正式）

---

## 9. `metrics:collect` vs `fleet report`

### 区别

- `metrics:collect`：单仓指标快照。
- `fleet report`：多仓聚合报告。

### 选择

- 只看当前仓：`metrics:collect`
- 要做跨仓治理：`fleet collect + fleet report + fleet doctor`

---

## 10. `new-change` vs `explore` vs `migrate-specs`

### 区别

- `new-change`：创建变更容器。
- `explore`：查看变更状态与上下文指令。
- `migrate-specs`：把 change 下的 delta 迁移到 canonical specs。

### 常见正确顺序

1. `sbk new-change <id>`
2. 执行开发与文档变更
3. `sbk explore --change <id>`（复盘上下文）
4. `sbk migrate-specs --change <id> --apply`（在合适时机）

---

## 11. Stable vs Beta（能力近似但风险不同）

### 结论

- 默认选 `stable`。
- 只有在明确需要实验能力且可承受回滚成本时再用 `beta`。

### Beta 进入前最少检查

1. 是否有回滚分支和回滚命令。
2. 是否连续两轮 `verify:ci` 通过。
3. 是否安排了额外观察窗口（至少两个 PR 周期）。
