# Silver Bullet Kernel 项目概览

## 项目定位

**Silver Bullet Kernel** 是一个以 AI 为核心的棕地开发工作流内核，旨在解决 AI 辅助编程中的三大核心挑战：

| 挑战 | 问题描述 | 解决方案 |
|------|----------|----------|
| **AI 无记忆** | 每次会话从零开始，无法累积项目知识 | Trellis 工作区持久化会话记录 |
| **AI 缺乏项目特定知识** | AI 只懂通用模式，不懂你的项目规范 | spec/ 目录注入项目特定指南 |
| **AI 上下文窗口有限** | 会话越长，AI 越"忘记"规则 | check-* 命令在关键节点重新验证 |

## 核心设计思想

### 1. 资产即真理 (Artifacts as Source of Truth)

```
传统方式：知识在对话中 → 会话结束即丢失
本项目：知识在文件中 → 版本控制、可追溯、可复用
```

**关键资产目录：**
- `.trellis/` - Trellis 工作流系统配置和会话记录
- `openspec/` - OpenSpec 变更管理和规格定义
- `xxx_docs/` - 项目运维文档

### 2. 策略即代码 (Policy-as-Code)

工作流策略不是口头约定，而是可执行、可验证的配置：

```yaml
# .trellis/policy.yaml 示例
thresholds:
  verify_failure_rate:
    warn: 0.2    # 超过 20% 警告
    fail: 0.5    # 超过 50% 失败
```

### 3. 阶段门禁只认证据 (Gate Evidence)

每个阶段转换都需要客观证据：

```
计划 → 实现：需要 OpenSpec change 创建
实现 → 提交：需要 verify 通过
提交 → 合并：需要 policy gate 通过
```

### 4. 失败资产化 (Failure as Asset)

失败不是浪费，而是知识资产：

```
.trellis/gotchas/
├── index.md              # 经验教训索引
└── ai-memory-limits.md   # 具体教训文档
```

### 5. 可观测性优先 (Observability First)

6 个核心指标持续监控工作流健康度：

| 指标 | 含义 | 健康阈值 |
|------|------|----------|
| Lead Time P50/P90 | 任务完成时间 | P90 < 24h |
| Verify Failure Rate | 验证失败率 | < 20% |
| Rework Count | 返工次数 | < 3 次/周 |
| Parallel Throughput | 并行任务数 | >= 1 |
| Spec Drift Events | 规格漂移 | = 0 |
| Token Cost | API 成本 | 可追踪 |

## 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                     用户 / AI 助手                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  Trellis 工作流系统                                          │
│  ├── /trellis:start      恢复上下文                          │
│  ├── /trellis:record-session  记录会话                      │
│  └── hooks (session-start, ralph-loop)  自动化注入          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  OpenSpec 变更管理                                           │
│  ├── openspec new change <name>   创建变更                  │
│  ├── openspec status              查看状态                  │
│  └── openspec archive             归档变更                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  质量门禁                                                    │
│  ├── npm run verify:fast    快速验证                         │
│  ├── npm run verify         完整验证                         │
│  ├── npm run workflow:policy   策略门禁                      │
│  └── npm run workflow:gate     指标门禁                      │
└─────────────────────────────────────────────────────────────┘
```

## 文档阅读顺序

| 序号 | 文档 | 内容 |
|------|------|------|
| 1 | [01-快速开始](01-快速开始.md) | 环境准备、初始化、首次运行 |
| 2 | [02-核心概念](02-核心概念.md) | Trellis、OpenSpec、Policy 深入理解 |
| 3 | [03-日常工作流程](03-日常工作流程.md) | 每日开发的标准操作流程 |
| 4 | [04-变更管理](04-变更管理.md) | 如何创建、跟踪、归档变更 |
| 5 | [05-质量门禁](05-质量门禁.md) | 验证、CI、策略执行 |
| 6 | [06-可观测性](06-可观测性.md) | 指标采集、周报生成 |
| 7 | [07-多人协作](07-多人协作.md) | worktree 隔离、分支策略 |
| 8 | [08-最佳实践](08-最佳实践.md) | 推荐做法和反模式 |
| 9 | [09-故障排除](09-故障排除.md) | 常见问题诊断和解决 |

## 人机分工

### 必须由人执行的操作

| 操作 | 原因 |
|------|------|
| `git commit` / `git push` | 代码责任归属 |
| 架构决策 | 产品方向、技术选型 |
| 敏感信息处理 | 安全合规 |
| 初始化框架 | 项目骨架定义 |
| Skill 添加决策 | 工具扩展权限 |

### AI 可协助执行的操作

| 操作 | 说明 |
|------|------|
| 会话管理 | `/trellis:start`, `/trellis:record-session` |
| 代码开发 | 编写、重构、调试 |
| 检查验证 | `/trellis:check-*`, `npm run verify` |
| 任务管理 | 创建、更新任务 |
| 文档生成 | 生成报告、更新文档 |

## 快速命令参考

```bash
# 环境初始化
npm install                    # 安装依赖
npm run verify:fast            # 快速验证
npm run workflow:doctor        # 健康检查

# 日常工作
npm run verify                 # 完整验证
npm run workflow:policy        # 策略检查
npm run workflow:gate          # 指标检查

# 指标和报告
npm run metrics:collect        # 采集指标
npm run metrics:report         # 生成周报
npm run workflow:doctor        # 健康诊断

# 变更管理
openspec new change <name>     # 创建变更
openspec status                # 查看状态
openspec archive <name>        # 归档变更
```
